{"version":3,"sources":["../../src/js/editor.js"],"names":["pasteNum","pasteEditors","DateTime","luxon","prettyOffset","i","isNeg","input","Math","abs","hour","floor","frac","mins","hs","toString","padStart","ms","pre","getAbsoluteExpiry","makeDate","date","document","getElementById","time","tz","dateValue","value","timeValue","tzValue","tzNum","Number","prettyTz","dateString","finalDate","fromISO","getRelativeExpiry","yearsElem","daysElem","hoursElem","minutesElem","years","days","hours","minutes","isNaN","local","plus","getExpiry","expires","setTimezone","tzSelect","offset","undefined","children","forEach","e","setAttribute","removeAttribute","createUpload","getLanguage","parent","lang","querySelector","files","Object","values","editor","editorRoot","parentElement","file","getCode","id","push","codeFlaskSucksHighlight","hljs","highlightBlock","elCode","classList","clazz","startsWith","remove","setUpEditor","el","div","createElement","style","height","CodeSass","defaultTheme","lineNumbers","language","hidden","type","name","insertAdjacentElement","background","padding","setHighlightCallback","nameInput","langInput","updateLanguage","getSuffixFromName","split","pop","suffix","updateCode","code","addEventListener","createLineNumbers","toDelete","removeFile","addFile","base","clone","cloneNode","getElementsByTagName","ta","updateButtons","num","keys","length","enabled","getElementsByName","button","disabled","createEditors","querySelectorAll","JSON","stringify","target","appendChild","expiry","expiresInput","inputsRequired","req","rel","add","expirationDate","dataset","year","month","day","minute"],"mappings":"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","file":"editor.js","sourcesContent":["/* global hljs:false, CodeSass:false, luxon:false */\n\nlet pasteNum = 0;\nconst pasteEditors = {};\n\n(function() {\n  const DateTime = luxon.DateTime;\n\n  /**\n   * Formats a UTC offset into \"+04:30\" format from a decimal like 4.5.\n   *\n   * @param {Number} i Decimal representing UTC offset\n   * @returns {String} Formatted String\n   */\n  function prettyOffset(i) {\n    // check if the offset is negative for formatting later. all the math will be done as if it were\n    // positive\n    const isNeg = i < 0;\n\n    const input = Math.abs(i);\n\n    // get the hour component by stripping off the fraction\n    const hour = Math.floor(input);\n\n    // subtract the hour component to get the fraction\n    const frac = input - hour;\n\n    const mins = 60 * frac;\n\n    // pad with leading zeroes\n    const hs = hour.toString().padStart(2, '0');\n    const ms = mins.toString().padStart(2, '0');\n\n    const pre = isNeg ? '-' : '+';\n    return `${pre}${hs}:${ms}`;\n  }\n\n  /**\n   * @param {boolean} makeDate Whether to turn the ISO String into a Date\n   * @returns {null | DateTime | String} The absolute expiry date set by the user, if set, otherwise\n   * null. Returns an ISO string if makeDate is false, a DateTime if true.\n   */\n  function getAbsoluteExpiry(makeDate) {\n    const date = document.getElementById('absolute-date');\n    const time = document.getElementById('absolute-time');\n    const tz = document.getElementById('absolute-timezone');\n\n    if (date === null || time === null || tz === null) {\n      return null;\n    }\n\n    const dateValue = date.value;\n    const timeValue = time.value;\n    const tzValue = tz.value;\n\n    if (!dateValue || !timeValue || !tzValue) {\n      return null;\n    }\n\n    const tzNum = Number(tzValue);\n\n    const prettyTz = tzNum === 0 ? 'Z' : prettyOffset(tzNum);\n\n    const dateString = `${dateValue}T${timeValue}:00.000${prettyTz}`;\n\n    const finalDate = DateTime.fromISO(dateString);\n\n    if (makeDate) {\n      return finalDate;\n    }\n\n    return finalDate.toString();\n  }\n\n  function getRelativeExpiry(makeDate) {\n    const yearsElem = document.getElementById('relative-years');\n    const daysElem = document.getElementById('relative-days');\n    const hoursElem = document.getElementById('relative-hours');\n    const minutesElem = document.getElementById('relative-minutes');\n\n    if (yearsElem === null || daysElem === null || hoursElem === null || minutesElem === null) {\n      return null;\n    }\n\n    const years = Number(yearsElem.value ? yearsElem.value : '0');\n    const days = Number(daysElem.value ? daysElem.value : '0');\n    const hours = Number(hoursElem.value ? hoursElem.value : '0');\n    const minutes = Number(minutesElem.value ? minutesElem.value : '0');\n\n    if (isNaN(years) || isNaN(days) || isNaN(hours) || isNaN(minutes)) {\n      return null;\n    }\n\n    if (years + days + hours + minutes === 0) {\n      return null;\n    }\n\n    const date = DateTime.local().plus({\n      years,\n      days,\n      hours,\n      minutes,\n    });\n\n    if (makeDate) {\n      return date;\n    }\n\n    return date.toString();\n  }\n\n  /**\n   * @returns { null | String } date\n   */\n  function getExpiry() {\n    const expires = document.getElementById('expires');\n    if (expires === null) {\n      return null;\n    }\n\n    switch (expires.value) {\n      case 'relative':\n        return getRelativeExpiry(false);\n      case 'absolute':\n        return getAbsoluteExpiry(false);\n      default:\n        return null;\n    }\n  }\n\n  function setTimezone(tz) {\n    const tzSelect = document.getElementById('absolute-timezone');\n    if (tzSelect === null) {\n      return;\n    }\n\n    const offset = tz === undefined ? DateTime.local().offset / 60 : tz;\n    [...tzSelect.children].forEach(e => {\n      if (Number(e.value) === offset) {\n        e.setAttribute('selected', '');\n      } else {\n        e.removeAttribute('selected');\n      }\n    });\n  }\n\n  /**\n   * Create the upload array for handling multiple files.\n   *\n   * @returns {[{name: string, language: string, content: string}]} Array of upload files.\n   */\n  function createUpload() {\n    function getLanguage(parent) {\n      const lang = parent.querySelector('select[name=file_language]').value;\n      if (lang === '') {\n        return null;\n      }\n      return lang;\n    }\n\n    const files = [];\n    for (const editor of Object.values(pasteEditors)) {\n      const parent = editor.editorRoot.parentElement.parentElement.parentElement;\n      const file = {\n        'name': parent.querySelector('input[name=file_name]').value,\n        'language': getLanguage(parent),\n        'content': editor.getCode(),\n      };\n      const id = editor.editorRoot.parentElement.parentElement.parentElement.querySelector('input[name=id]');\n      if (id !== null) {\n        file.id = id.value;\n      }\n      files.push(file);\n    }\n    return files;\n  }\n\n  function codeFlaskSucksHighlight(editor) {\n    hljs.highlightBlock(editor.elCode);\n    // remove the extra classes hljs adds without asking\n    for (const clazz of editor.elCode.classList) {\n      if (clazz !== 'hljs' && clazz !== 'codeflask__code' && !clazz.startsWith('language-')) {\n        editor.elCode.classList.remove(clazz);\n      }\n    }\n  }\n\n  /**\n   * Create an editor.\n   *\n   * @param {HTMLElement} parent The file container.\n   * @param {HTMLElement} el The element to convert into an editor.\n   */\n  function setUpEditor(parent, el) {\n    const div = document.createElement('div');\n\n    div.style.height = '400px';\n\n    const editor = new CodeSass(div, {\n      defaultTheme: false,\n      lineNumbers: true,\n      language: 'plaintext',\n    });\n\n    const hidden = document.createElement('input');\n    hidden.type = 'hidden';\n    hidden.name = 'file_content';\n    hidden.id = 'hidden_content';\n    editor.editorRoot.insertAdjacentElement('afterend', hidden);\n\n    editor.elCode.style.background = 'none';\n    editor.elCode.style.padding = '0';\n\n    editor.setHighlightCallback(codeFlaskSucksHighlight);\n\n    const nameInput = parent.querySelector('input[name=file_name]');\n    const langInput = parent.querySelector('select[name=file_language]');\n\n    function updateLanguage() {\n      function getSuffixFromName(name) {\n        if (name === 'CMakeLists.txt') {\n          return 'CMake';\n        }\n\n        return name.split('.').pop();\n      }\n\n      let suffix;\n      if (langInput.value !== '') {\n        suffix = langInput.value;\n      } else if (nameInput.value !== '') {\n        suffix = getSuffixFromName(nameInput.value);\n      }\n      const lang = hljs.getLanguage(suffix) !== undefined ? suffix : 'plaintext';\n      editor.updateLanguage(lang);\n      editor.updateCode(editor.code);\n    }\n\n    nameInput.addEventListener('input', updateLanguage);\n    langInput.addEventListener('change', updateLanguage);\n\n    updateLanguage();\n    editor.updateCode(el.value);\n    editor.createLineNumbers(); // TODO: fix this in codesass\n\n    const toDelete = pasteNum;\n    parent\n      .querySelector('button[name=delete_button]')\n      .addEventListener('click', () => removeFile(toDelete));\n\n    pasteEditors[pasteNum] = editor;\n\n    el.insertAdjacentElement('beforebegin', div);\n    el.remove();\n  }\n\n  function addFile() {\n    // get the base file for cloning (should be invisible if JS is running)\n    const base = document.getElementById('base_file');\n\n    // deep clone the base\n    const clone = base.cloneNode(true);\n\n    // show the editor by removing the requires-no-js class that was on the base\n    clone.classList.remove('requires-no-js');\n\n    pasteNum += 1;\n    clone.id = `file${pasteNum}`;\n\n    // set up an editor for each textarea in the base (should only be one)\n    for (const ta of clone.getElementsByTagName('textarea')) {\n      setUpEditor(clone, ta);\n    }\n\n    // add the editor to the dom\n    document.getElementById('end_of_files').insertAdjacentElement('beforebegin', clone);\n\n    updateButtons();\n  }\n\n  /**\n   * Remove a file. Will never remove the last file.\n   *\n   * @param {Number} num The number of the file to remove.\n   */\n  function removeFile(num) {\n    if (Object.keys(pasteEditors).length === 1) {\n      return;\n    }\n\n    const file = document.getElementById(`file${num}`);\n\n    if (file === null) {\n      return;\n    }\n\n    delete pasteEditors[num];\n\n    file.remove();\n\n    updateButtons();\n  }\n\n  function updateButtons() {\n    const enabled = Object.keys(pasteEditors).length > 1;\n    for (const button of document.getElementsByName('delete_button')) {\n      if (enabled) {\n        button.disabled = false;\n      } else {\n        button.disabled = true;\n      }\n    }\n  }\n\n  function createEditors() {\n    for (const editor of document.querySelectorAll('textarea.editor')) {\n      pasteNum += 1;\n      setUpEditor(editor.parentElement.parentElement.parentElement, editor);\n    }\n    updateButtons();\n  }\n\n  document.getElementById('add_file').addEventListener('click', addFile);\n\n  document.getElementById('paste_upload').addEventListener('submit', e => {\n    const input = document.createElement('input');\n    input.type = 'hidden';\n    input.value = JSON.stringify(createUpload());\n    input.name = 'upload_json';\n\n    e.target.appendChild(input);\n\n    const expiry = getExpiry();\n    if (expiry !== null) {\n      const expiresInput = document.createElement('input');\n      expiresInput.type = 'hidden';\n      expiresInput.value = expiry;\n      expiresInput.name = 'expires';\n\n      e.target.appendChild(expiresInput);\n    }\n  });\n\n  // create any initial editors\n  createEditors();\n\n  // add an initial file if necessary\n  if (Object.keys(pasteEditors).length === 0) {\n    addFile();\n  }\n\n  // set the default timezone\n  setTimezone();\n\n  (function() {\n    function inputsRequired(el, req) {\n      el.querySelectorAll('input, select').forEach(e => {\n        if (req) {\n          e.setAttribute('required', '');\n          return;\n        }\n        e.removeAttribute('required');\n      });\n    }\n\n    const expires = document.getElementById('expires');\n    if (expires === null) {\n      return;\n    }\n    expires.addEventListener('change', e => {\n      const expiry = e.target.value;\n      const abs = document.getElementById('absolute-expiry');\n      const rel = document.getElementById('relative-expiry');\n      if (expiry === 'relative') {\n        abs.classList.add('is-hidden');\n        rel.classList.remove('is-hidden');\n        inputsRequired(abs, false);\n        inputsRequired(rel, true);\n      } else if (expiry === 'absolute') {\n        abs.classList.remove('is-hidden');\n        rel.classList.add('is-hidden');\n        inputsRequired(abs, true);\n        inputsRequired(rel, false);\n      } else {\n        abs.classList.add('is-hidden');\n        rel.classList.add('is-hidden');\n        inputsRequired(abs, false);\n        inputsRequired(rel, false);\n      }\n    });\n  })();\n\n  (function() {\n    const abs = document.getElementById('absolute-expiry');\n    const expirationDate = abs.dataset.expirationDate;\n    if (expirationDate === undefined) {\n      return;\n    }\n\n    const date = DateTime.fromISO(expirationDate);\n\n    const year = date.year;\n    const month = date.month.toString().padStart(2, '0');\n    const day = date.day.toString().padStart(2, '0');\n    document.getElementById('absolute-date').value = `${year}-${month}-${day}`;\n\n    const hour = date.hour.toString().padStart(2, '0');\n    const minute = date.minute.toString().padStart(2, '0');\n    document.getElementById('absolute-time').value = `${hour}:${minute}`;\n\n    document.getElementById('absolute-timezone').value = `${date.offset / 60}`;\n  })();\n})();\n"]}